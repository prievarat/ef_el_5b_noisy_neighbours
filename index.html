<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Noisy Neighbours - Grammar Building</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Nunito:wght@400;700&display=swap" rel="stylesheet">
    
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: { 300: '#F9C97A', 500: '#F4A329', 700: '#B45309' },
                        secondary: { 300: '#7EDAD6', 500: '#2BB6B4', 700: '#0F766E' },
                        accent: { 300: '#F49DB8', 500: '#E8467B', 700: '#A61E4D' },
                        bg: '#FFF7F2',
                        surface: '#FFFFFF',
                        text: { main: '#1F2937', muted: '#6B7280' },
                        building: { dark: '#1e293b', window: '#0f172a' }
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        display: ['Nunito', 'sans-serif'],
                    },
                    boxShadow: {
                        'soft': '0 4px 20px -2px rgba(0, 0, 0, 0.1)',
                        'glow': '0 0 15px rgba(249, 201, 122, 0.5)',
                    }
                }
            }
        }
    </script>

    <style>
        /* Custom Animations */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        .shake-animation {
            animation: shake 0.4s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fadeIn 0.5s ease-out forwards;
        }

        /* Window Logic */
        .window-shutter {
            transition: all 0.5s ease-in-out;
            background-color: rgba(15, 23, 42, 0.85); /* Dark blue night overlay */
            backdrop-filter: blur(2px);
        }
        
        .window-container:hover .window-shutter {
            background-color: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(0px);
            box-shadow: inset 0 0 20px rgba(244, 163, 41, 0.3);
        }

        .window-container.active .window-shutter {
            opacity: 0; /* Light is ON */
            pointer-events: none;
        }

        /* Solved State */
        .window-container.solved {
            border-color: #2F9E44;
            box-shadow: 0 0 15px rgba(47, 158, 68, 0.4);
        }
        
        /* Custom Scrollbar for the building container if needed */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: transparent;
        }
        ::-webkit-scrollbar-thumb {
            background: #CBD5E1;
            border-radius: 4px;
        }
    </style>
</head>
<body class="bg-bg text-text-main min-h-screen flex flex-col font-sans selection:bg-primary-300 selection:text-primary-700">

    <header class="w-full bg-surface border-b border-gray-200 py-4 px-6 shadow-sm sticky top-0 z-50">
        <div class="max-w-4xl mx-auto flex justify-between items-center">
            <h1 class="font-display font-bold text-2xl text-primary-700 flex items-center gap-2">
                <i data-lucide="building-2" class="w-8 h-8"></i>
                Noisy Neighbours
            </h1>
            <div class="text-sm font-medium text-text-muted bg-gray-100 px-3 py-1 rounded-full">
                <span id="progress-display">0</span>/12 Solved
            </div>
        </div>
    </header>

    <main class="flex-grow flex flex-col items-center justify-center p-4 md:p-8">
        
        <div class="relative bg-building-dark p-6 rounded-t-3xl shadow-2xl border-4 border-b-0 border-gray-700 max-w-3xl w-full">
            <div class="absolute -top-6 left-1/2 transform -translate-x-1/2 w-3/4 h-6 bg-gray-700 rounded-t-2xl"></div>

            <div class="grid grid-cols-4 gap-4 md:gap-6">
                
                </div>
        </div>

        <div class="w-full max-w-3xl bg-surface border-t-4 border-primary-500 shadow-soft rounded-b-3xl p-6 md:p-8 relative z-20">
            <div id="interaction-area" class="text-center transition-all duration-300">
                
                <div id="welcome-msg" class="py-8">
                    <div class="inline-block p-4 bg-primary-300 rounded-full mb-4 text-primary-700">
                        <i data-lucide="moon" class="w-8 h-8"></i>
                    </div>
                    <h2 class="text-xl font-bold text-gray-800 mb-2">It's a quiet evening... or is it?</h2>
                    <p class="text-text-muted">Click on a dark window to see what the neighbours are doing.</p>
                </div>

                <div id="question-box" class="hidden animate-fade-in max-w-xl mx-auto">
                    <span class="text-xs font-bold tracking-wider text-secondary-700 uppercase mb-2 block" id="flat-label">FLAT 1A</span>
                    <h3 class="text-2xl md:text-3xl font-display font-bold text-gray-800 mb-6" id="question-text">
                        The baby <span class="text-primary-500">________</span> (cry).
                    </h3>
                    
                    <div class="relative">
                        <input type="text" id="answer-input" 
                            class="w-full text-center text-xl p-4 border-2 border-gray-200 rounded-2xl focus:border-secondary-500 focus:ring-4 focus:ring-secondary-300/30 outline-none transition-all placeholder:text-gray-300"
                            placeholder="Type the verb..." autocomplete="off">
                        
                        <button id="submit-btn" class="absolute right-2 top-2 bottom-2 bg-secondary-500 hover:bg-secondary-700 text-white rounded-xl px-6 font-bold transition-colors flex items-center gap-2">
                            Check <i data-lucide="arrow-right" class="w-4 h-4"></i>
                        </button>
                    </div>
                    
                    <p id="feedback-msg" class="h-6 mt-3 text-sm font-semibold transition-opacity opacity-0 text-error">Try again!</p>
                </div>

            </div>
        </div>
    </main>

    <footer class="text-center py-6 text-text-muted text-sm">
        <p>Topic: Present Continuous â€¢ Theme: Noisy Neighbours</p>
    </footer>

    <script>
        // Data Structure based on user input
        const flats = [
            // Floor 3
            { id: '3a', img: 'flat_3a.jpg', sentence: "He ________ (practise) the guitar.", answer: "is practising", alts: ["is practicing"] },
            { id: '3b', img: 'flat_3b.jpg', sentence: "He ________ (sing) very loudly.", answer: "is singing" },
            { id: '3c', img: 'flat_3c.jpg', sentence: "They ________ (play) video games.", answer: "are playing" }, // Missing Pic Placeholder handled
            { id: '3d', img: 'flat_3d.jpg', sentence: "He ________ (play) the drums.", answer: "is playing" },   // Missing Pic Placeholder handled
            
            // Floor 2
            { id: '2a', img: 'flat_2a.jpg', sentence: "The dog ________ (bark) at the cat.", answer: "is barking" },
            { id: '2b', img: 'flat_2b.jpg', sentence: "They ________ (argue).", answer: "are arguing" },
            { id: '2c', img: 'flat_2c.jpg', sentence: "He ________ (listen) to loud music.", answer: "is listening" }, // Fallback logic used here
            { id: '2d', img: 'flat_2d.jpg', sentence: "They ________ (have) a party.", answer: "are having" },

            // Floor 1
            { id: '1a', img: 'flat_1a.jpg', sentence: "He ________ (renovate) the flat.", answer: "is renovating" },
            { id: '1b', img: 'flat_1b.jpg', sentence: "She ________ (clean) the carpet.", answer: "is cleaning" },
            { id: '1c', img: 'flat_1c.jpg', sentence: "They ________ (move) the furniture.", answer: "are moving" },
            { id: '1d', img: 'flat_1d.jpg', sentence: "She ________ (cook) loudly.", answer: "is cooking" }
        ];

        let activeFlatId = null;
        let solvedFlats = new Set();

        // Initialize Icons
        lucide.createIcons();

        // Build the Grid
        const gridContainer = document.querySelector('.grid');
        
        flats.forEach(flat => {
            const flatDiv = document.createElement('div');
            flatDiv.className = `window-container group relative aspect-square bg-gray-800 rounded-lg overflow-hidden border-2 border-gray-600 cursor-pointer transition-all hover:border-primary-300 hover:scale-[1.02]`;
            flatDiv.dataset.id = flat.id;
            flatDiv.onclick = () => handleFlatClick(flat.id);

            // Image Layer (with fallback for missing images)
            const img = document.createElement('img');
            img.src = flat.img;
            img.alt = `Flat ${flat.id}`;
            img.className = "w-full h-full object-cover";
            // Fallback: If image fails (3c/3d), show a placeholder div
            img.onerror = function() {
                this.style.display = 'none';
                this.nextElementSibling.style.display = 'flex';
            };

            // Fallback Element
            const fallback = document.createElement('div');
            fallback.className = "hidden absolute inset-0 bg-gray-700 flex-col items-center justify-center text-gray-400 p-2 text-center";
            fallback.innerHTML = `<i data-lucide="image-off" class="w-8 h-8 mb-1"></i><span class="text-xs">Image Pending</span>`;

            // Night Overlay (The Shutter)
            const shutter = document.createElement('div');
            shutter.className = "window-shutter absolute inset-0 flex items-center justify-center";
            shutter.innerHTML = `<span class="text-white/80 font-bold text-lg opacity-0 group-hover:opacity-100 transition-opacity drop-shadow-md shadow-black">${flat.id.toUpperCase()}</span>`;

            flatDiv.appendChild(img);
            flatDiv.appendChild(fallback);
            flatDiv.appendChild(shutter);
            gridContainer.appendChild(flatDiv);
        });

        // Re-run icons for new elements
        lucide.createIcons();

        // Game Functions
        function handleFlatClick(id) {
            if (solvedFlats.has(id)) return; // Already done

            // Reset previous active state
            document.querySelectorAll('.window-container').forEach(el => el.classList.remove('active', 'ring-4', 'ring-primary-500'));
            
            // Set new active
            const activeEl = document.querySelector(`.window-container[data-id="${id}"]`);
            activeEl.classList.add('active', 'ring-4', 'ring-primary-500');
            
            activeFlatId = id;
            renderQuestion(id);
        }

        function renderQuestion(id) {
            const flat = flats.find(f => f.id === id);
            const welcomeMsg = document.getElementById('welcome-msg');
            const questionBox = document.getElementById('question-box');
            
            // Hide welcome, show question
            welcomeMsg.style.display = 'none';
            questionBox.classList.remove('hidden');
            
            // Populate content
            document.getElementById('flat-label').textContent = `Flat ${id.toUpperCase()}`;
            document.getElementById('question-text').innerHTML = flat.sentence.replace('________', `<span class="text-primary-500 border-b-2 border-primary-500 px-2">________</span>`);
            
            const input = document.getElementById('answer-input');
            input.value = '';
            input.focus();
            
            document.getElementById('feedback-msg').style.opacity = '0';
        }

        function checkAnswer() {
            if (!activeFlatId) return;

            const flat = flats.find(f => f.id === activeFlatId);
            const input = document.getElementById('answer-input');
            const userVal = input.value.trim().toLowerCase().replace(/\s+/g, ' '); // normalize spaces
            
            const isCorrect = userVal === flat.answer || (flat.alts && flat.alts.includes(userVal));

            if (isCorrect) {
                handleSuccess(flat);
            } else {
                handleFailure();
            }
        }

        function handleSuccess(flat) {
            const feedback = document.getElementById('feedback-msg');
            feedback.textContent = "Correct!";
            feedback.className = "h-6 mt-3 text-sm font-semibold text-success transition-opacity opacity-100";
            
            // Mark flat as solved
            const flatDiv = document.querySelector(`.window-container[data-id="${flat.id}"]`);
            flatDiv.classList.add('solved');
            flatDiv.classList.remove('ring-4', 'ring-primary-500'); // Remove active ring, keep 'solved' border
            
            // Keep light on (remove shutter visually)
            const shutter = flatDiv.querySelector('.window-shutter');
            shutter.style.opacity = '0';

            solvedFlats.add(flat.id);
            document.getElementById('progress-display').textContent = solvedFlats.size;

            // Confetti effect or simple success sound could go here
            
            // Clear input area after delay
            setTimeout(() => {
                if (solvedFlats.size === 12) {
                    showFinalSuccess();
                } else {
                    document.getElementById('answer-input').value = '';
                    document.getElementById('question-text').innerHTML = flat.sentence.replace('________', `<span class="text-success font-bold">${flat.answer}</span>`);
                }
            }, 500);
        }

        function handleFailure() {
            const feedback = document.getElementById('feedback-msg');
            feedback.textContent = "Oops! Check the verb form. (e.g., 'is crying')";
            feedback.className = "h-6 mt-3 text-sm font-semibold text-error transition-opacity opacity-100";
            
            const input = document.getElementById('answer-input');
            input.parentElement.classList.add('shake-animation');
            setTimeout(() => input.parentElement.classList.remove('shake-animation'), 400);
        }

        function showFinalSuccess() {
            const questionBox = document.getElementById('question-box');
            questionBox.innerHTML = `
                <div class="text-center py-8">
                    <div class="inline-block p-4 bg-success rounded-full mb-4 text-white animate-bounce">
                        <i data-lucide="party-popper" class="w-10 h-10"></i>
                    </div>
                    <h2 class="text-3xl font-bold text-gray-800 mb-2">Building Complete!</h2>
                    <p class="text-lg text-text-muted">You've identified all the noisy neighbours.</p>
                    <button onclick="location.reload()" class="mt-6 bg-primary-500 text-white px-8 py-3 rounded-full font-bold hover:bg-primary-700 transition">Play Again</button>
                </div>
            `;
            lucide.createIcons();
        }

        // Listeners
        document.getElementById('submit-btn').addEventListener('click', checkAnswer);
        document.getElementById('answer-input').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') checkAnswer();
        });

    </script>
</body>
</html>